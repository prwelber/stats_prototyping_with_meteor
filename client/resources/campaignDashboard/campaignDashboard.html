<template name="campaignDashboard">

  {{#if isReady "Initiatives" "campaignInsightList"}}
    <div class="row dashboard-initiative-header">
      <a href="/initiatives/{{getInitiative._id}}/homepage"><h2>Initiative & Line Items</h2></a>
      <div class="col s3">
        <p class="center-align border-bottom">Name</p>
        <h4 class="center-align no-top-margin">{{getInitiative.name}}</h4>
      </div>
      <div class="col s3">
        <p class="center-align border-bottom">Agency</p>
        <h4 class="center-align no-top-margin">{{getInitiative.agency}}</h4>
      </div>
      <div class="col s3">
      <p class="center-align border-bottom">Brand</p>
        <h4 class="center-align no-top-margin">{{getInitiative.brand}}</h4>
      </div>
      <div class="col s3">
      <p class="center-align border-bottom">Product</p>
        <h4 class="center-align no-top-margin">{{getInitiative.product}}</h4>
      </div>
    </div>
    <div class="row" style="margin-bottom: 0px;">
      <table class="centered">
        {{#each getInitiative.lineItems}}
          <thead>
            <tr>
              {{#if objective}} <th>Objective</th> {{/if}}
              {{#if platform}} <th>Platform</th> {{/if}}
              {{#if dealType}} <th>Deal Type</th> {{/if}}
              {{#if quantity}} <th>Quantity</th> {{/if}}
              {{#if price}} <th>Price</th> {{/if}}
              {{#if budget}} <th>Budget</th> {{/if}}
              {{#if startDate}} <th>Start Date</th> {{/if}}
              {{#if endDate}} <th>End Date</th> {{/if}}
              {{#if isInRole "admin"}}
                {{#if costPlusPercent}} <th>Cost Plus</th> {{/if}}
                {{#if percentTotalPercent}} <th>Percent Total</th> {{/if}}
                {{#if isClientPercent}} <th>Client</th> {{/if}}
              {{/if}}
            </tr>
          </thead>
          <tbody>
            <tr>
              {{#if objective}}<td>{{objective}}</td>{{/if}}
              {{#if platform}}<td>{{platform}}</td>{{/if}}
              {{#if dealType}}<td>{{dealType}}</td>{{/if}}
              {{#if quantity}}<td>{{number quantity}}</td>{{/if}}
              {{#if price}}<td>{{price}}</td>{{/if}}
              {{#if budget}}<td>{{money budget}}</td>{{/if}}
              {{#if startDate}}<td>{{formatDate startDate}}</td>{{/if}}
              {{#if endDate}}<td>{{formatDate endDate}}</td>{{/if}}
              {{#if isInRole "admin"}}
                {{#if costPlusPercent}}<td>{{costPlusPercent}}%</td>{{/if}}
                {{#if percentTotalPercent}}<td>{{percentTotalPercent}}%</td>{{/if}}
                {{#if isClientPercent}}<td>{{isClientPercent}}%</td>{{/if}}
              {{/if}}
            </tr>
          </tbody>
        {{/each}}
      </table>
    </div>
    <br>

  <div class="container">
    <div class="row">
      {{#with fetchInsights}}
      <h2 class="center-align">{{campaign_name}}</h2>
      <p class="center-align">Updated: {{timezone inserted}}</p>


      <div class="col s6 m6 l6 card grey lighten-5">
        <div class="card-content">
          <span class="center-align dash-data">{{campaign_id}}</span><br>
          <span class="">Campaign ID</span>
        </div>
      </div>
      <div class="col s6 m6 l6 card grey lighten-5">
        <div class="card-content">
          <span class="center-align dash-data">{{objectiveText objective}}</span><br>
          <span class="">Objective</span>
        </div>
      </div>

      <p class="fancy"><span>Core Stats</span></p>
      {{#if isInRole "admin"}}
        <div class="col s6 m4 l3 card grey lighten-5">
          <div class="card-content">
            <span class="center-align dash-data">{{money spend}}</span><br>
            <span class="">Spend</span>
          </div>
        </div>
        <div class="col s6 m4 l3 card {{highlight 'CPM'}}">
          <div class="card-content">
            <span class="center-align dash-data">{{money cpm}}</span><br>
            <span class="">CPM</span>
          </div>
        </div>
        <div class="col s6 m4 l3 card {{highlight 'CPC'}}">
          <div class="card-content">
            <span class="center-align dash-data">{{money cpc}}</span><br>
            <span class="">CPC</span>
          </div>
        </div>
        <div class="col s6 m4 l3 card {{highlight 'CPVV'}}">
          <div class="card-content ">
            <span class="center-align dash-data">{{money cost_per_video_view}}</span><br>
            <span class="">CPVV</span>
          </div>
        </div>
       {{!--  <div class="col s6 m4 l3 card {{likesObjective}}">
          <div class="card-content ">
            <span class="center-align dash-data">{{money cpl}}</span><br>
            <span class="">CPL</span>
          </div>
        </div> --}}

      {{else}}
        {{!------------ BELOW IS WHAT CLIENT SEES ------------}}
        <div class="col s6 m4 l3 card grey lighten-5">
          <div class="card-content ">
            <span class="center-align dash-data">{{clientStatsSpend spend "spend"}}</span><br>
            <span class="">Spend</span>
          </div>
        </div>
        <div class="col s6 m4 l3 card {{highlight 'CPM'}}">
          <div class="card-content ">
            <span class="center-align dash-data">{{money clientStats.cpm}}</span><br>
            <span class="">CPM</span>
          </div>
        </div>
        <div class="col s6 m4 l3 card {{highlight 'CPC'}}">
          <div class="card-content ">
            <span class="center-align dash-data">{{money clientStats.cpc}}</span><br>
            <span class="">CPC</span>
          </div>
        </div>
        <div class="col s6 m4 l3 card {{highlight 'CPVV'}}">
          <div class="card-content ">
            <span class="center-align dash-data">{{money clientStats.cpvv}}</span><br>
            <span class="">CPVV</span>
          </div>
        </div>
        <div class="col s6 m4 l3 card {{highlight 'CPL'}}">
          <div class="card-content ">
            <span class="center-align dash-data">{{money clientStats.cpl}}</span><br>
            <span class="">CPL</span>
          </div>
        </div>
      {{/if}}

      <div class="col s6 m4 l3 card grey lighten-5">
        <div class="card-content ">
          <span class="center-align dash-data">{{number total_actions}}</span><br>
          <span class="">Total Actions</span>
        </div>
      </div>
      <div class="col s6 m4 l3 card {{highlight 'CPM'}}">
        <div class="card-content">
          <span class="center-align dash-data">{{number impressions}}</span><br>
          <span class="">Impressions</span>
        </div>
      </div>

      <div class="col s6 m4 l3 card {{highlight 'CPC'}}">
        <div class="card-content ">
          <span class="center-align dash-data">{{number clicks}}</span><br>
          <span class="">Clicks</span>
        </div>
      </div>

      <div class="col s6 m4 l3 card grey lighten-5">
        <div class="card-content ">
          <span class="center-align dash-data">{{number link_click}}</span><br>
          <span class="">Link Clicks</span>
        </div>
      </div>

      <div class="col s6 m4 l3 card {{highlight 'CPL'}}">
        <div class="card-content">
          <span class="center-align dash-data">{{number like}}</span><br>
          <span class="">Likes</span>
        </div>
      </div>
      <div class="col s6 m4 l3 card {{highlight 'CPVV'}}">
        <div class="card-content ">
          <span class="center-align dash-data">{{number video_view}}</span><br>
          <span class="">Video Views</span>
        </div>
      </div>
      <div class="col s6 m4 l3 card grey lighten-5">
        <div class="card-content ">
          <span class="center-align dash-data">{{number page_engagement}}</span><br>
          <span class="">Page Engagement</span>
        </div>
      </div>
      <div class="col s6 m4 l3 card grey lighten-5">
        <div class="card-content ">
          <span class="center-align dash-data">{{number post_engagement}}</span><br>
          <span class="">Post Engagement</span>
        </div>
      </div>

      {{#if offsite_conversion}}
        <div class="col s6 m4 l3 card grey lighten-5">
          <div class="card-content ">
            <span class="center-align dash-data">{{number offsite_conversion}}</span><br>
            <span class="">Offsite Conversions</span>
          </div>
        </div>
        <div class="col s6 m4 l3 card grey lighten-5">
          <div class="card-content ">
            <span class="center-align dash-data">{{number offsite_conversion_fb_pixel_add_to_cart}}</span><br>
            <span class="">Conv - Add to Cart</span>
          </div>
        </div>
        <div class="col s6 m4 l3 card grey lighten-5">
          <div class="card-content ">
            <span class="center-align dash-data">{{number offsite_conversion_fb_pixel_view_content}}</span><br>
            <span class="">Conv - View Content</span>
          </div>
        </div>
        <div class="col s6 m4 l3 card grey lighten-5">
          <div class="card-content ">
            <span class="center-align dash-data">{{number offsite_conversion_fb_pixel_purchase}}</span><br>
            <span class="">Conv - Purchase</span>
          </div>
        </div>
      {{/if}}
      {{!-- end of conversion stats --}}

    {{!-- Show client stats --}}
    {{#if isInRole "admin"}}
      <div class="col s12">
        <p class="fancy" style="margin-bottom: 1em;"><span>Client Stats</span></p>
      </div>
      <div class="col s6 m4 l3 card grey lighten-5">
        <div class="card-content ">
          <span class="center-align dash-data">{{clientStatsSpend spend "spend"}}</span><br>
          <span class="">Client Spend</span>
        </div>
      </div>

      <div class="col s6 m4 l3 card {{highlight 'CPM'}}">
        <div class="card-content ">
          <span class="center-align dash-data">{{money clientStats.cpm}}</span><br>
          <span class="">Client CPM</span>
        </div>
      </div>

      <div class="col s6 m4 l3 card {{highlight 'CPC'}}">
        <div class="card-content ">
          <span class="center-align dash-data">{{money clientStats.cpc}}</span><br>
          <span class="">Client CPC</span>
        </div>
      </div>
      <div class="col s6 m4 l3 card {{highlight 'CPL'}}">
        <div class="card-content ">
          <span class="center-align dash-data">{{money clientStats.cpl}}</span><br>
          <span class="">Client CPL</span>
        </div>
      </div>
      <div class="col s6 m4 l3 card {{highlight 'CPVV'}}">
        <div class="card-content ">
          <span class="center-align dash-data">{{money clientStats.cpvv}}</span><br>
          <span class="">Client CPVV</span>
        </div>
      </div>
    {{/if}}
  {{/with}}
  </div> {{!-- end of row --}}
  </div>
  {{getAggregate}}
  {{else}}
    <p>Loading...</p>
  {{/if}}

</template>
